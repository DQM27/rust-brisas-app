%% Motor de Validaci√≥n - Flujo de Decisi√≥n
%% Pegar en https://mermaid.live para visualizar

flowchart TD
    START([üì• Solicitud de Ingreso]) --> CTX[Crear ContextoIngreso]
    
    CTX --> LN{¬øEn Lista Negra?}
    LN -->|S√≠| BLOCK_LN[‚ùå BLOQUEADO<br/>Motivo: Lista Negra]
    LN -->|No| IA{¬øIngreso Activo?}
    
    IA -->|S√≠| BLOCK_IA[‚ùå BLOQUEADO<br/>Ya est√° adentro]
    IA -->|No| TIPO{Tipo de Ingreso}
    
    TIPO -->|Contratista| PRAIND{¬øPRAIND Vigente?}
    TIPO -->|Proveedor| CORREO{¬øAutorizaci√≥n Correo?}
    TIPO -->|Visita| CITA{¬øTiene Cita/Correo?}
    
    PRAIND -->|No| BLOCK_PR[‚ùå BLOQUEADO<br/>PRAIND vencido]
    PRAIND -->|S√≠| ESTADO_C{¬øEstado Activo?}
    
    CORREO -->|No| BLOCK_CO[‚ùå BLOQUEADO<br/>Sin autorizaci√≥n]
    CORREO -->|S√≠| ESTADO_P{¬øEstado Activo?}
    
    CITA -->|No| BLOCK_CI[‚ùå BLOQUEADO<br/>Sin cita/autorizaci√≥n]
    CITA -->|S√≠| CHECK_ALT[Verificar Alertas]
    
    ESTADO_C -->|Inactivo| BLOCK_ES[‚ùå BLOQUEADO<br/>Contratista inactivo]
    ESTADO_C -->|Activo| CHECK_ALT
    
    ESTADO_P -->|Inactivo| BLOCK_EP[‚ùå BLOQUEADO<br/>Proveedor inactivo]
    ESTADO_P -->|Activo| CHECK_ALT
    
    CHECK_ALT --> ALERTAS{¬øAlertas Gafete<br/>Pendientes?}
    
    ALERTAS -->|S√≠| OK_WARN[‚úÖ PERMITIDO<br/>‚ö†Ô∏è Con advertencia]
    ALERTAS -->|No| OK[‚úÖ PERMITIDO]
    
    OK --> END([üì§ Resultado])
    OK_WARN --> END
    BLOCK_LN --> END
    BLOCK_IA --> END
    BLOCK_PR --> END
    BLOCK_CO --> END
    BLOCK_CI --> END
    BLOCK_ES --> END
    BLOCK_EP --> END
    
    style START fill:#4ecdc4,stroke:#1a9c94,color:#fff
    style END fill:#4ecdc4,stroke:#1a9c94,color:#fff
    style OK fill:#00b894,stroke:#00a085,color:#fff
    style OK_WARN fill:#fdcb6e,stroke:#f39c12,color:#333
    style BLOCK_LN fill:#e74c3c,stroke:#c0392b,color:#fff
    style BLOCK_IA fill:#e74c3c,stroke:#c0392b,color:#fff
    style BLOCK_PR fill:#e74c3c,stroke:#c0392b,color:#fff
    style BLOCK_CO fill:#e74c3c,stroke:#c0392b,color:#fff
    style BLOCK_CI fill:#e74c3c,stroke:#c0392b,color:#fff
    style BLOCK_ES fill:#e74c3c,stroke:#c0392b,color:#fff
    style BLOCK_EP fill:#e74c3c,stroke:#c0392b,color:#fff
