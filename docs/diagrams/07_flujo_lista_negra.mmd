%% Flujo de Lista Negra - DiseÃ±o Corregido
%% Pegar en https://mermaid.live para visualizar

flowchart TB
    subgraph CONCEPTO["ğŸ“‹ Concepto: Bloqueado = No puede NADA"]
        C1["ğŸš« SI estÃ¡ en Lista Negra:"]
        C2["âŒ NO puede ingresar como Contratista"]
        C3["âŒ NO puede ingresar como Proveedor"]
        C4["âŒ NO puede ingresar como Visita"]
        C5["âŒ NO puede ser REGISTRADO en el sistema"]
        
        C1 --> C2
        C1 --> C3
        C1 --> C4
        C1 --> C5
    end

    subgraph NIVELES["âš ï¸ Niveles de Severidad - Propuesta"]
        N1["ğŸ”´ ALTO - Persona peligrosa/agresiva<br/>ProhibiciÃ³n permanente, alertar a seguridad"]
        N2["ğŸŸ  MEDIO - Conflicto laboral/robo menor<br/>ProhibiciÃ³n pero sin alerta especial"] 
        N3["ğŸŸ¡ BAJO - TerminaciÃ³n de relaciÃ³n laboral<br/>Solo se le prohÃ­be acceso"]
    end

    subgraph FLUJO_BLOQUEO["ğŸ‘¤ Proceso de Bloquear Persona"]
        direction TB
        
        B1[Admin/Supervisor inicia bloqueo]
        B2{Â¿Persona ya existe<br/>en el sistema?}
        B3["ğŸ” BUSCAR por nombre/cÃ©dula<br/>en contratistas, proveedores, visitantes"]
        B4["ğŸ“ REGISTRO MANUAL<br/>CÃ©dula, Nombre, Apellido, Empresa"]
        B5["Seleccionar Nivel de Severidad"]
        B6["Escribir Motivo del Bloqueo"]
        B7["âœ… Persona Bloqueada"]
        
        B1 --> B2
        B2 -->|SÃ­| B3
        B2 -->|No| B4
        B3 --> B5
        B4 --> B5
        B5 --> B6
        B6 --> B7
    end

    subgraph VALIDACIONES["ï¿½ Validaciones AutomÃ¡ticas"]
        V1["Al intentar INGRESAR<br/>(cualquier tipo)"]
        V2["Al intentar REGISTRAR<br/>(nuevo contratista/proveedor/visita)"]
        V3{Â¿CÃ©dula en<br/>lista_negra?}
        V4["âŒ RECHAZAR + Mostrar motivo"]
        V5["âœ… Permitir"]
        
        V1 --> V3
        V2 --> V3
        V3 -->|SÃ­| V4
        V3 -->|No| V5
    end

    subgraph DATOS["ï¿½ Datos del Bloqueo"]
        D1["id: UUID"]
        D2["cedula: TEXT NOT NULL"]
        D3["nombre, apellido: TEXT"]
        D4["empresa_id: FK opcional a empresas"]
        D5["empresa_nombre: TEXT (si no tiene FK)"]
        D6["nivel_severidad: ALTO|MEDIO|BAJO"]
        D7["motivo_bloqueo: TEXT NOT NULL"]
        D8["bloqueado_por: FK a users"]
        D9["is_active: 1=bloqueado, 0=desbloqueado"]
    end

    CONCEPTO --> FLUJO_BLOQUEO
    FLUJO_BLOQUEO --> VALIDACIONES
